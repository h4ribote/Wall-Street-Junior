# Game Design Document: Paper Street

## 1. プロジェクト概要
**Paper Street** は、現実的な金融市場をシミュレートしたトレーディングゲームです。「Wall Street Junior」をインスピア元とし、プロフェッショナルなトレーダーとしての体験を提供します。

### コンセプト
*   **"The Terminal"**: プレイヤーは高度な金融端末を操作するトレーダーとなり、情報（ニュース、データ）を武器に市場で利益を上げることを目指します。
*   **リアリティとゲーム性の融合**: 実際の金融理論（金利、インフレ、企業業績）に基づいたシミュレーションでありながら、ゲームとして楽しめるイベントやシナリオを用意します。

## 2. コアゲームプレイ
### ループ
1.  **情報収集**: ニュースフィード、企業レポート、マクロ経済指標を確認。
2.  **分析**: チャート分析、ファンダメンタルズ分析を行い、市場の動向を予測。
3.  **取引実行**: 株式、債券、通貨などの売買注文を出す。信用取引やヘッジも駆使する。
4.  **ポートフォリオ管理**: リスク管理を行いながら、資産（Equity）を最大化する。

## 3. 経済システム（リアリティ重視）
リアリティを追求するため、以下の高度な経済モデルを実装します。

### 高度な市場シミュレーション
*   **24時間市場 (24/7 Market)**: 株式、債券、FXを含むすべての資産クラスが、24時間365日取引可能です。
*   **Order Book (板情報) システム**: 単なる価格変動ではなく、Buy/Sellの注文状況（板）を可視化。プレイヤーの注文が板に並び、実際に市場価格に影響を与える。
*   **流動性 (Liquidity)**: 取引量が少ない銘柄ではスプレッドが広がり、大量注文が価格を大きく動かす（Market Impact）リスクを再現。
*   **マクロ経済指標**: 金利（政策金利）、インフレ率（CPI）、GDP、失業率などの指標が定期的に発表され、すべての資産クラスに相関的な影響を与える。
*   **相関マトリクス**: 「金利上昇→債券価格下落」「原油高→航空株下落」といった資産間のリアルな相関関係をシミュレート。

### 資産クラスの拡充
*   **Stocks**: セクター分類（Tech, Energy, Finance等）と、ファンダメンタルズ（PER, EPS）に基づく価格形成。
*   **Bonds**: イールドカーブの概念を導入。短期・中期・長期国債の利回り変動。

## 4. リアルタイム要素
「同じ市場を見る」だけでなく、「互いに影響し合う」マルチプレイヤー体験を提供します。

### Global Market (MMO型市場)
*   **単一市場サーバー**: 全プレイヤーが同じサーバー上の市場に接続。あるプレイヤーの大量売りは、他のプレイヤーのチャートにもリアルタイムで反映される。
*   **流動性とボット (Market Bots)**: 実際の市場と同様に、取引の大半はボットが担う。これにより、「プレイヤーがいないと板がスカスカ」という問題を解決し、常にリアルな価格変動を生み出す。

### 取引アルゴリズム (AI Traders)
注文板（Order Book）は、プレイヤーだけでなく、以下の多様なロジックを持つボット群によって駆動されます。

1.  **Market Makers (流動性供給)**:
    *   常に現在価格の上下にBuy/Sellの指値注文を出し続け、スプレッド（売値と買値の差）を維持する。
    *   市場に厚みを持たせ、プレイヤーがいつでも売買できるようにする役割。
2.  **Trend Followers (順張り)**:
    *   移動平均線などのテクニカル指標を監視し、トレンドが発生した方向に追随して注文を出す。
    *   相場の「勢い」を作り出す。
3.  **Mean Reverters (逆張り)**:
    *   RSIなどで「買われすぎ/売られすぎ」を判断し、過熱した相場の是正（反転）を狙う。
4.  **Whales / Institutional (機関投資家)**:
    *   膨大な資金を持ち、定期的に大量の注文（実需）を執行する。アイスバーグ注文（見せ板隠し）なども使用し、市場にインパクトを与えるイベント的な存在。
5.  **News Reactors (ヘッドライン取引)**:
    *   ゲーム内のニュースフィードに反応し、ミリ秒単位で「ポジティブなら買い」「ネガティブなら売り」を行うHFT（高頻度取引）ボット。

## 5. UI/UX デザイン（The Paper Street Terminal）
プロフェッショナルなトレーダーが使用する「情報端末」を再現しつつ、ゲームとしての使いやすさを両立させます。

### 画面レイアウト案
画面全体を複数のパネル（ウィジェット）で構成し、プレイヤーが自由に配置を変更できるドッキングシステムを採用します。

1.  **Header (ステータスバー)**:
    *   **資産情報**: 総資産 (Equity), 評価損益 (Unrealized P/L), 余力 (Buying Power), レバレッジ比率。
    *   **市場概況**: 全体指数（S&P 500的なもの）、ニュース速報テロップ。
2.  **Market Watch (監視リスト)**:
    *   お気に入り銘柄のリスト。現在値、変動率、ミニチャートを表示。
3.  **Chart Panel (メイン)**:
    *   多機能チャート（TradingView）。インジケーター（MA, Bollinger Bands, MACD等）の追加が可能。
    *   **Drag & Drop Order**: チャート上の価格ラインをドラッグして指値を変更する直感的な操作。
4.  **Order Book & Depth (板情報)**:
    *   **Level 2 Data**: すべての指値注文を可視化。
    *   **Depth Chart**: 売り圧・買い圧のバランスを視覚的に表示。
5.  **Time & Sales (歩み値)**:
    *   約定履歴のリアルタイム表示。大口注文（Whale）は色を変えて強調表示。
6.  **Position & Orders (建玉管理)**:
    *   現在の保有ポジション一覧。ここから「全決済」「ドテン売買」などのクイックアクションが可能。

## 6. プレイヤーアクション
### 注文タイプ (Order Types)
*   **Market (成行)**: 即座に約定させる。スリッページのリスクあり。
*   **Limit (指値)**: 指定価格で待つ。流動性供給者（Maker）として手数料リベートを得られる（予定）。
*   **Stop / Stop Limit**: 損切りやブレイクアウト狙い。

### 取引手数料 (Fees)
* `fee_tier` で手数料率が決定される。

| fee_tier | maker_fee | taker_fee |
| --- | --- | --- |
| 1 | 0.02% | 0.10% |
| 2 | 0.01% | 0.05% |
| 3 | 0.00% | 0.00% |

## 7. ゲーム進行 (Seasonal System)
MMOとしての長期的なモチベーションを維持するため、シーズン制を導入します。

### シーズンサイクル (2ヶ月)
*   **リセット**: シーズン終了時に全プレイヤーの資産とポジションはリセットされる。
*   **ランキング**: 「総資産額」「最大瞬間ROI」などでランキングを決定。
*   **報酬**:
    *   **称号 (Titles)**: "Wolf of Paper Street", "Market Wizard" など。
    *   **Boost**: 上位プレイヤーは、次シーズンのスタート時の`fee_tier`が優遇される。

### シーズンテーマ (Dynamic Meta)
シーズンごとに市場の「ルール」や「トレンド」が変化します。
*   **The Great Depression**: 全体的に弱気相場。空売りのスキルが試される。
*   **Tech Bubble**: テック株のボラティリティが極端に高い。
*   **Hyperinflation**: 現金の価値が下がるため、常にポジションを持っておく必要がある。

## 8. 技術スタック（Python & Docker）
ユーザーの要望に基づき、バックエンドはPythonで統一し、Dockerで環境を構築します。

*   **Frontend**: HTML5 / JavaScript (Vanilla ES6+)
    *   ビルドツール不要のシンプルな構成。
    *   **CSS Framework**: Tailwind CSS または Bootstrap 5 でデザインを効率化。
    *   **Charting Library**: Lightweight Charts (TradingView) - 高性能かつ軽量なチャート描画。
*   **Backend**: Python 3.12+ (FastAPI)
    *   非同期処理（`asyncio`）を活用し、高頻度な注文処理をさばく。
*   **Database**: MySQL 8.0
    *   ユーザーデータ、資産、注文履歴の永続化。
*   **Infrastructure**: Docker & Docker Compose
    *   **App Container**: FastAPIサーバー
    *   **DB Container**: MySQL
    *   **Bot Containers**: 複数のPythonスクリプト（Market Maker, Whale等）を独立したコンテナとして起動し、API経由で市場に参加させる。
*   **Real-time**: WebSocket (FastAPI標準のサポートを利用)
